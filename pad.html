<!DOCTYPE html>
<html lang="ja">
<head>
<title>MTML Pad</title>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript" src="mt-static/plugins/MTMLPad/CodeMirror2/lib/codemirror.js"></script>
<script type="text/javascript" src="mt-static/plugins/MTMLPad/js/codemirror/mtml-mode.js"></script>

<script type="text/javascript">
$( function () {

// Syntax Highlight
var modeLoop = [ 'text', 'mtml', 'mtmloverlay' ];
var currentMode = 1;
var mtml_mode = true;
var codeMirrorOptions = {
  mode: 'mtml',
  lineNumbers: true,
  indentUnit: 0,
  electricChars: false,
  enterMode: 'flat',
  tabMode: 'classic',
  undoDepth: 2000,
  onCursorActivity: function (editor, changed) {
    var cursor = editor.getCursor();
    jQuery('#editor-state').text(
      'line: ' + cursor.line + ' : ' + cursor.ch
    );
  }
};

var textarea = $('#template').get(0);
var editor = CodeMirror.fromTextArea(textarea, codeMirrorOptions );


// Auto Preview
var last_text = '';

var do_preview = function (text) {
    $.ajax( 'http://localhost:5000', {
        type: 'POST',
        data: {
            template: text
        },
        success: function ( data, textStatus, jqXHR ) {
            $('#preview-state').text('OK');
            $('#preview').text(data);
        },
        error: function ( jqXHR, textStatus, errorThrown ) {
            $('#preview-state').text('Error: ' + jqXHR.responseText);
        }
    });
}

var preview = function () {
    var text = editor.getValue();
    if ( last_text !== text ) {
        last_text = text;
        do_preview(text);
    }
}

var timer = setInterval( preview, 500);


});




</script>
<link rel="stylesheet" href="mt-static/plugins/MTMLPad/CodeMirror2/lib/codemirror.css" />
<link rel="stylesheet" href="mt-static/plubins/MTMLPad/css/styles.css" />

</head>
<body>
  <div id="header">
    <span id="logo">MTML Pad</span>
    <span id="user">aklaswad</span>
  </div>
  <div id="content">
    <div id="editor-area">
      <textarea id="template"></textarea>
    </div>
    <div id="preview-area">
      <span id="preview-state"></span>
      <pre id="preview"></pre>
    </div>
  </div>
</body>
</html>
